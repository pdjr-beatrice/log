#!/bin/bash

LOG_FOLDER=log/
WORDPRESS_FOLDER=wordpress/

SYMBOLIC=
LOG_DIRECTORY=
LOG_UNINSTALL="/usr/local/bin/log-uninstall"

if [ "${1}" == "" ] ; then
  echo "usage: install [-s] log_directory"
  exit 1
fi

while [ "${1}" != "" ] ; do
  case ${1} in
    -s)
      SYMBOLIC=yes
      echo "install: installing by symbolic link"
      ;;
    *)
      LOG_DIRECTORY="${1}"
      ;;
  esac
done

if [ "${LOG_DIRECTORY}" == "" ] ; then
  echo "install: log directory must be specified"
  exit 1
else
  if [ ! -d "${LOG_DIRECTORY}" ] ; then
    mkdir -p "${LOG_DIRECTORY}"
    chmod 777 "${LOG_DIRECTORY}"
  fi
fi

rm "${LOG_UNINSTALL}"
touch "${LOG_UNINSTALL}"
    
if [ -d "${LOG_FOLDER}" ] ; then
  cd "${LOG_FOLDER}"
  for INSTALL_DIR_PATTERN in * ; do
    INSTALL_DIR="/${INSTALL_DIR_PATTERN//\.//}"
    pushd "${INSTALL_DIR_PATTERN}" > /dev/null
    for SCRIPT_NAME in * ; do
      SCRIPT_PATHNAME=$( realpath ${SCRIPT_NAME} )
      pushd "${INSTALL_DIR}" > /dev/null
      rm -f ${SCRIPT_NAME}
      echo "rm \"${INSTALL_DIR}${SCRIPT_NAME}\"" >> "${LOG_UNINSTALL}"
      if [ "${SYMBOLIC}" == "yes" ] ; then
        ln -s "${SCRIPT_PATHNAME}" .
      else
        cp "${SCRIPT_PATHNAME}" .
      fi
      chmod 755 "${SCRIPT_NAME}"
      popd > /dev/null
    done
    popd > /dev/null
  done
fi
